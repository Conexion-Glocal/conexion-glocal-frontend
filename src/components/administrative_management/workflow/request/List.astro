---
import { Icon } from "astro-icon/components";

import { handleFind } from "@resources/index";

const { endpoint, permissions } = Astro.props;
const response = await handleFind(endpoint);
const data = response?.status === 200 ? response?.data : null;
---

<!--
  This example requires some changes to your config:
  
  ```
  // tailwind.config.js
  module.exports = {
    // ...
    plugins: [
      // ...
      require('@tailwindcss/forms'),
    ],
  }
  ```
-->
<div>
    <div class="block">
        <div class="border-b border-gray-200">
            <nav class="-mb-px flex space-x-8" aria-label="Tabs">
                <!-- Current: "border-indigo-500 text-indigo-600", Default: "border-transparent text-gray-500 hover:border-gray-300 hover:text-gray-700" -->
                <a
                    href="#"
                    class="w-1/3 justify-center text-center group inline-flex items-center border-b-2 border-emerald-700 px-1 py-4 text-sm font-medium text-emerald-700 truncate"
                    aria-current="page"
                >
                    <svg
                        xmlns="http://www.w3.org/2000/svg"
                        fill="none"
                        viewBox="0 0 24 24"
                        stroke-width="1.5"
                        stroke="currentColor"
                        class="-ml-0.5 mr-2 h-5 w-5 text-emerald-700"
                    >
                        <path
                            stroke-linecap="round"
                            stroke-linejoin="round"
                            d="M19.5 14.25v-2.625a3.375 3.375 0 0 0-3.375-3.375h-1.5A1.125 1.125 0 0 1 13.5 7.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H8.25m0 12.75h7.5m-7.5 3H12M10.5 2.25H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 0 0-9-9Z"
                        ></path>
                    </svg>
                    <span>Mis solicitudes</span>
                </a>
                <a
                    href="#"
                    class="w-1/3 justify-center group inline-flex items-center border-b-2 border-transparent px-1 py-4 text-sm font-medium text-gray-500 hover:border-gray-300 hover:text-gray-700 truncate"
                >
                    <svg
                        xmlns="http://www.w3.org/2000/svg"
                        fill="none"
                        viewBox="0 0 24 24"
                        stroke-width="1.5"
                        stroke="currentColor"
                        class="-ml-0.5 mr-2 h-5 w-5 text-gray-400 group-hover:text-gray-500"
                    >
                        <path
                            stroke-linecap="round"
                            stroke-linejoin="round"
                            d="M19.5 14.25v-2.625a3.375 3.375 0 0 0-3.375-3.375h-1.5A1.125 1.125 0 0 1 13.5 7.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H8.25m6.75 12H9m1.5-12H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 0 0-9-9Z"
                        ></path>
                    </svg>
                    <span>Pendientes de gesti√≥n</span>
                </a>
                <a
                    href="#"
                    class="w-1/3 justify-center text-center group inline-flex items-center border-b-2 border-transparent px-1 py-4 text-sm font-medium text-gray-500 hover:border-gray-300 hover:text-gray-700 truncate"
                >
                    <svg
                        xmlns="http://www.w3.org/2000/svg"
                        fill="none"
                        viewBox="0 0 24 24"
                        stroke-width="1.5"
                        stroke="currentColor"
                        class="-ml-0.5 mr-2 h-5 w-5 text-gray-400 group-hover:text-gray-500"
                    >
                        <path
                            stroke-linecap="round"
                            stroke-linejoin="round"
                            d="M10.125 2.25h-4.5c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125v-9M10.125 2.25h.375a9 9 0 0 1 9 9v.375M10.125 2.25A3.375 3.375 0 0 1 13.5 5.625v1.5c0 .621.504 1.125 1.125 1.125h1.5a3.375 3.375 0 0 1 3.375 3.375M9 15l2.25 2.25L15 12"
                        ></path>
                    </svg>
                    <span>Gestionadas</span>
                </a>
            </nav>
        </div>
    </div>
</div>

<ul
    class="divide-y divide-gray-100 bg-white shadow-sm ring-1 ring-gray-900/5 sm:rounded-xl"
>
    <li
        class="relative flex justify-between gap-x-6 px-4 py-5 hover:bg-gray-50 sm:px-6"
    >
        <div class="flex min-w-0 gap-x-4">
            <div class="min-w-0 flex-auto">
                <p class="text-sm font-semibold leading-6 text-gray-900">
                    <a href="#" @click.prevent={`isInfoDrawerOpen = true`}>
                        <span class="absolute inset-x-0 -top-px bottom-0"
                        ></span>
                        Solicitud 0000000001
                    </a>
                </p>
                <p class="mt-1 flex text-xs leading-5 text-gray-500">
                    Lorem ipsum dolor sit amet consectetur adipisicing elit.
                    Ipsa molestiae hic aut molestias laboriosam, dignissimos
                    fuga nostrum ipsam harum assumenda iusto laborum amet
                    accusantium vitae quas ea sed blanditiis sequi.
                </p>
            </div>
        </div>
        <div
            class="flex flex-none items-center gap-x-4"
            x-data="{isListOptionsMenuOpen: false}"
        >
            <div class="relative flex-none">
                {
                    permissions?.delete || permissions?.update ? (
                        <button
                            class="-m-2.5 block p-2.5 text-gray-500 hover:text-gray-900"
                            type="button"
                            @click="isListOptionsMenuOpen = ! isListOptionsMenuOpen"
                        >
                            <Icon
                                class="h-5 w-5"
                                name="shared/ellipsis-vertical"
                            />
                        </button>
                    ) : (
                        ""
                    )
                }
                <div
                    class="absolute right-0 z-10 mt-2 w-32 origin-top-right rounded-md bg-white py-2 shadow-lg ring-1 ring-gray-900/5 focus:outline-none"
                    tabindex="-1"
                    x-show="isListOptionsMenuOpen"
                    @click.outside="isListOptionsMenuOpen = false"
                >
                    {
                        permissions?.update ? (
                            <a
                                href="#"
                                class="block px-3 py-1 text-sm leading-6 text-gray-900 hover:bg-gray-50"
                                tabindex="-1"
                                @click.prevent={`isUpdateWindowOpen = true`}
                            >
                                Editar
                            </a>
                        ) : (
                            ""
                        )
                    }
                    {
                        permissions?.delete ? (
                            <a
                                href="#"
                                class="block px-3 py-1 text-sm leading-6 text-gray-900 hover:bg-gray-50"
                                tabindex="-1"
                                @click.prevent={`isDeleteWindowOpen = true;`}
                            >
                                Eliminar
                            </a>
                        ) : (
                            ""
                        )
                    }
                    |
                </div>
            </div>
        </div>
    </li>
    {
        data
            ? data.map(({ description, id, name }) => (
                  <li class="relative flex justify-between gap-x-6 px-4 py-5 hover:bg-gray-50 sm:px-6">
                      <div class="flex min-w-0 gap-x-4">
                          <div class="min-w-0 flex-auto">
                              <p class="text-sm font-semibold leading-6 text-gray-900">
                                  <a
                                      href="#"
                                      @click.prevent={`isInfoDrawerOpen = true; description = '${description || ""}'; id = '${id}'; name = '${name}';`}
                                  >
                                      <span class="absolute inset-x-0 -top-px bottom-0" />
                                      {name}
                                  </a>
                              </p>
                              <p class="mt-1 flex text-xs leading-5 text-gray-500">
                                  {description}
                              </p>
                          </div>
                      </div>
                      <div
                          class="flex flex-none items-center gap-x-4"
                          x-data="{isListOptionsMenuOpen: false}"
                      >
                          <div class="relative flex-none">
                              {permissions?.delete || permissions?.update ? (
                                  <button
                                      class="-m-2.5 block p-2.5 text-gray-500 hover:text-gray-900"
                                      type="button"
                                      @click="isListOptionsMenuOpen = ! isListOptionsMenuOpen"
                                  >
                                      <Icon
                                          class="h-5 w-5"
                                          name="shared/ellipsis-vertical"
                                      />
                                  </button>
                              ) : (
                                  ""
                              )}
                              <div
                                  class="absolute right-0 z-10 mt-2 w-32 origin-top-right rounded-md bg-white py-2 shadow-lg ring-1 ring-gray-900/5 focus:outline-none"
                                  tabindex="-1"
                                  x-show="isListOptionsMenuOpen"
                                  @click.outside="isListOptionsMenuOpen = false"
                              >
                                  {permissions?.update ? (
                                      <a
                                          href="#"
                                          class="block px-3 py-1 text-sm leading-6 text-gray-900 hover:bg-gray-50"
                                          tabindex="-1"
                                          @click.prevent={`isUpdateWindowOpen = true; description = '${description || ""}'; id = '${id}'; name = '${name}'`}
                                      >
                                          Editar
                                      </a>
                                  ) : (
                                      ""
                                  )}
                                  {permissions?.delete ? (
                                      <a
                                          href="#"
                                          class="block px-3 py-1 text-sm leading-6 text-gray-900 hover:bg-gray-50"
                                          tabindex="-1"
                                          @click.prevent={`isDeleteWindowOpen = true; id = '${id}'`}
                                      >
                                          Eliminar
                                      </a>
                                  ) : (
                                      ""
                                  )}
                                  |
                              </div>
                          </div>
                      </div>
                  </li>
              ))
            : ""
    }
</ul>
